#version 120
uniform vec4 MaskProps;
uniform vec4 DiffuseColor;
uniform vec2 renderTargetSize;
uniform float AttenuateShadows;

uniform sampler2D shadowMapSampler;
uniform sampler2D inputSampler;
const float minBlur = 1.0;
const float maxBlur = 20.0;
const int g_cKernelSize = 13;
const vec2 weights_offsets0 = vec2( -6, 0.002216 );
const vec2 weights_offsets1 = vec2( -5, 0.008764 );
const vec2 weights_offsets2 = vec2( -4, 0.026995 );
const vec2 weights_offsets3 = vec2( -3, 0.064759 );
const vec2 weights_offsets4 = vec2( -2, 0.120985 );
const vec2 weights_offsets5 = vec2( -1, 0.176033 );
const vec2 weights_offsets6 = vec2(  0, 0.199471 );
const vec2 weights_offsets7 = vec2(  1, 0.176033 );
const vec2 weights_offsets8 = vec2(  2, 0.120985 );
const vec2 weights_offsets9 = vec2(  3, 0.064759 );
const vec2 weights_offsets10 = vec2(  4, 0.026995 );
const vec2 weights_offsets11 = vec2(  5, 0.008764 );
const vec2 weights_offsets12 = vec2(  6, 0.002216 );
uniform vec2 OffsetAndWeight[g_cKernelSize] = vec2[g_cKernelSize]
(
    weights_offsets0,
    weights_offsets1,
    weights_offsets2,
    weights_offsets3,
    weights_offsets4,
    weights_offsets5,
    weights_offsets6,
    weights_offsets7,
    weights_offsets8,
    weights_offsets9,
    weights_offsets10,
    weights_offsets11,
    weights_offsets12
);

vec4 BlurVerticallyPS()
{
	  float sum=0;
	  float Distance = texture2D( inputSampler, gl_TexCoord[0].xy).b;
	  
      for (int i = 0; i < g_cKernelSize; i++)
	  {    
        sum += texture2D( inputSampler, gl_TexCoord[0].xy + OffsetAndWeight[i].x * mix(minBlur, maxBlur , Distance)/renderTargetSize.x * vec2(0,1) ).r * OffsetAndWeight[i].y;
      }
	  
	  float d = 2 * length(gl_TexCoord[0].xy - 0.5f);
	  float attenuation = pow(clamp(1.0f - d,0,1),1.0f);
	  
	  vec4 result = vec4(sum * attenuation);
	  result.a = 1;
      return result;
}

void main()
{
	gl_FragColor = BlurVerticallyPS();
}